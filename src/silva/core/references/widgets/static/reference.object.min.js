var ReferencedRemoteObject=function($,infrae){return function($widget,suffix){var identifier=$widget.attr("id"),url=$widget.find("#"+identifier+"-base").val(),required_interface=$widget.find("#"+identifier+"-interface").val(),show_index=$widget.find("#"+identifier+"-show-index").val(),default_message=$widget.data("reference-default-message")||"no reference selected.",$container=$widget.find("ul.multiple-references");suffix&&(identifier+=suffix);var $input=$widget.find("#"+identifier+"-value"),$link=$widget.find("#"+identifier+"-link"),$edit_link=$widget.find("#"+identifier+"-edit-link");if(!$link.length){var $item=$("<li />");$link=$('<a id="'+identifier+'-link" />'),$edit_link=$('<a id="'+identifier+'-edit-link" />'),$item.append($link),$item.append($edit_link),$container.append($item)}var remote={identifier:identifier+"-value",data:function(){return $input.data("referenced-remote-content")},reference:function(){return $input.val()},title:function(){var data=remote.data();return data?data.title:"no reference selected"},url:function(){var data=remote.data();return data?data.url:""},clear:function(reason){reason||(reason=default_message),$edit_link.hide(),$edit_link.attr("href","#"),$link.text(reason),$link.bind("click",function(){return!1}),$link.attr("href","#"),$link.removeAttr("title"),$input.length&&($input.val("0"),$input.trigger("remote-reference-modified",{}))},fetch:function(intid){var options={intid:intid};$link.text("loading ..."),$input.length&&$input.val(intid),required_interface&&(options["interface"]=required_interface),show_index&&(options.show_container_index="true"),$.getJSON(url+"/++rest++silva.core.references.items",options,remote.render)},render:function(info){if(void 0===info.url)return remote.fetch(info.intid),void 0;var $icon=$('<ins class="icon" />'),set_or_remove_attr=function(name,value){value?$link.attr(name,value):$link.removeAttr(name)};$link.empty(),$link.text(info.title),set_or_remove_attr("href",info.url),set_or_remove_attr("title",info.path),$link.unbind("click"),info.url&&($edit_link.show(),$edit_link.attr("href",info.path)),$link.data("content",info),infrae.ui.icon($icon,info.icon),$icon.prependTo($link),$input.length&&($input.val(info.intid),$input.trigger("reference-modified",info))},change:function(callback){$input.bind("reference-modified",callback)},show:$widget.show,hide:$widget.hide,toggle:$widget.toggle};return remote}}(jQuery,infrae);